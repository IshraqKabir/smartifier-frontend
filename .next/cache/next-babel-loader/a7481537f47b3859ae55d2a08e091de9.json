{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useEffect, useState } from \"react\";\nimport useLocalState from \"../../../custom-hooks/useLocalState\";\nimport submitTest from \"../../../repository/QuizTest/submitTest\";\nexport default function useTestState(quizId, questions, test, duration) {\n  _s();\n\n  var _useLocalState = useLocalState(\"user\", \"\"),\n      _useLocalState2 = _slicedToArray(_useLocalState, 1),\n      user = _useLocalState2[0];\n\n  var _useLocalState3 = useLocalState(\"\".concat(user === null || user === void 0 ? void 0 : user.email, \"-test\").concat(test === null || test === void 0 ? void 0 : test.id, \"-answers\"), {}),\n      _useLocalState4 = _slicedToArray(_useLocalState3, 2),\n      answers = _useLocalState4[0],\n      setAnswersState = _useLocalState4[1];\n\n  var _useState = useState(0),\n      currentQuestionIndex = _useState[0],\n      setCurrentQuestionIndex = _useState[1];\n\n  var _useState2 = useState(getProgress()),\n      progress = _useState2[0],\n      setProgress = _useState2[1];\n\n  var _useState3 = useState(function () {\n    if (!test) return 600;\n    return getTimeRemainingInSeconds(test === null || test === void 0 ? void 0 : test.created_at, duration.toString());\n  }),\n      secondsRemaining = _useState3[0],\n      setSecondsRemaining = _useState3[1];\n\n  var _useState4 = useState(\"\"),\n      timeRemaining = _useState4[0],\n      setTimeRemaing = _useState4[1];\n\n  var _useState5 = useState(false),\n      showSubmitButton = _useState5[0],\n      setShowSubmitButton = _useState5[1];\n\n  var _useState6 = useState(false),\n      isSubmitting = _useState6[0],\n      setIsSubmitting = _useState6[1];\n\n  useEffect(function () {\n    setInterval(function () {\n      setSecondsRemaining(getTimeRemainingInSeconds(test === null || test === void 0 ? void 0 : test.created_at, duration));\n    }, 500);\n  }, []);\n  useEffect(function () {\n    if (secondsRemaining <= 0) {\n      handleSubmit();\n      setTimeRemaing(\"Test Finished\");\n    } else {\n      setTimeRemaing(parseSecondsToClock(secondsRemaining));\n    }\n  }, [secondsRemaining]);\n  useEffect(function () {\n    setProgress(getProgress());\n\n    if (currentQuestionIndex == (questions === null || questions === void 0 ? void 0 : questions.length) - 1) {\n      setShowSubmitButton(true);\n    } else {\n      setShowSubmitButton(false);\n    }\n  }, [currentQuestionIndex]);\n\n  var setAnswers = function setAnswers(optionId, question, text) {\n    setAnswersState(function (state) {\n      var tempAnswers = _objectSpread({}, state);\n\n      if (question.answer_type === \"multiple_choice\") {\n        var options = tempAnswers[\"\".concat(question === null || question === void 0 ? void 0 : question.id)];\n\n        if (!options || Array.isArray(options) && !options[0]) {\n          tempAnswers = _objectSpread(_objectSpread({}, state), {}, _defineProperty({}, \"\".concat(question === null || question === void 0 ? void 0 : question.id), [{\n            optionId: optionId\n          }]));\n        }\n\n        if (options && Array.isArray(options) && options[0]) {\n          var _options$;\n\n          if (((_options$ = options[0]) === null || _options$ === void 0 ? void 0 : _options$.optionId) == optionId) {\n            tempAnswers = _objectSpread(_objectSpread({}, state), {}, _defineProperty({}, \"\".concat(question === null || question === void 0 ? void 0 : question.id), []));\n          } else {\n            tempAnswers = _objectSpread(_objectSpread({}, state), {}, _defineProperty({}, \"\".concat(question === null || question === void 0 ? void 0 : question.id), [{\n              optionId: optionId\n            }]));\n          }\n        }\n      } else if ((question === null || question === void 0 ? void 0 : question.answer_type) === \"checkboxes\") {\n        var _options = tempAnswers[\"\".concat(question === null || question === void 0 ? void 0 : question.id)];\n\n        if (!_options || Array.isArray(_options) && !_options[0]) {\n          tempAnswers = _objectSpread(_objectSpread({}, state), {}, _defineProperty({}, \"\".concat(question === null || question === void 0 ? void 0 : question.id), [{\n            optionId: optionId\n          }]));\n        }\n\n        if (_options && Array.isArray(_options)) {\n          var includes = false;\n          _options === null || _options === void 0 ? void 0 : _options.forEach(function (option) {\n            if ((option === null || option === void 0 ? void 0 : option.optionId) == optionId) {\n              includes = true;\n            }\n          });\n\n          if (includes) {\n            tempAnswers = _objectSpread(_objectSpread({}, state), {}, _defineProperty({}, \"\".concat(question === null || question === void 0 ? void 0 : question.id), _options === null || _options === void 0 ? void 0 : _options.filter(function (option) {\n              return (option === null || option === void 0 ? void 0 : option.optionId) != optionId;\n            })));\n          } else {\n            tempAnswers = _objectSpread(_objectSpread({}, state), {}, _defineProperty({}, \"\".concat(question === null || question === void 0 ? void 0 : question.id), [].concat(_toConsumableArray(_options), [{\n              optionId: optionId\n            }])));\n          }\n        }\n      } else if ((question === null || question === void 0 ? void 0 : question.answer_type) === \"short_paragraph\") {\n        if (!text) return _objectSpread({}, tempAnswers);\n        tempAnswers = _objectSpread(_objectSpread({}, state), {}, _defineProperty({}, \"\".concat(question === null || question === void 0 ? void 0 : question.id), [{\n          optionId: optionId,\n          text: text\n        }]));\n      }\n\n      return _objectSpread({}, tempAnswers);\n    });\n  };\n\n  var goToNextQuestion = function goToNextQuestion() {\n    if (currentQuestionIndex >= (questions === null || questions === void 0 ? void 0 : questions.length) - 1) return;\n    setCurrentQuestionIndex(currentQuestionIndex + 1);\n  };\n\n  var goToPreviousQuestion = function goToPreviousQuestion() {\n    if (currentQuestionIndex <= 0) return;\n    setCurrentQuestionIndex(currentQuestionIndex - 1);\n  };\n\n  var showPrevious = currentQuestionIndex != 0;\n  var showNext = currentQuestionIndex < (questions === null || questions === void 0 ? void 0 : questions.length) - 1;\n\n  function getProgress() {\n    if ((questions === null || questions === void 0 ? void 0 : questions.length) == 0) return 100;\n    return (currentQuestionIndex + 1) * 100 / (questions === null || questions === void 0 ? void 0 : questions.length);\n  }\n\n  function handleSubmit() {\n    return _handleSubmit.apply(this, arguments);\n  }\n\n  function _handleSubmit() {\n    _handleSubmit = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var _Object$values;\n\n      var processedAnswers, response;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!answers) alert(\"Not enough answers to submit!\");\n              setIsSubmitting(true);\n              processedAnswers = [];\n              (_Object$values = Object.values(answers)) === null || _Object$values === void 0 ? void 0 : _Object$values.forEach(function (answer) {\n                if (answer && Array.isArray(answer)) {\n                  answer === null || answer === void 0 ? void 0 : answer.forEach(function (option) {\n                    if (option === null || option === void 0 ? void 0 : option.optionId) {\n                      processedAnswers.push({\n                        optionId: option === null || option === void 0 ? void 0 : option.optionId,\n                        text: (option === null || option === void 0 ? void 0 : option.text) ? option === null || option === void 0 ? void 0 : option.text : \"\"\n                      });\n                    }\n                  });\n                }\n              });\n              _context.next = 6;\n              return submitTest(test === null || test === void 0 ? void 0 : test.id, processedAnswers, user === null || user === void 0 ? void 0 : user.token);\n\n            case 6:\n              response = _context.sent;\n\n              if (!(response.error || response == \"error\")) {\n                _context.next = 10;\n                break;\n              }\n\n              alert(\"Something went wrong. Please refresh and submit the test.\");\n              return _context.abrupt(\"return\");\n\n            case 10:\n              setAnswersState({});\n              window.location.href = \"/test/\".concat(test === null || test === void 0 ? void 0 : test.id, \"/result\");\n              setIsSubmitting(false);\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n    return _handleSubmit.apply(this, arguments);\n  }\n\n  return {\n    answers: answers,\n    setAnswers: setAnswers,\n    progress: progress,\n    currentQuestionIndex: currentQuestionIndex,\n    goToNextQuestion: goToNextQuestion,\n    goToPreviousQuestion: goToPreviousQuestion,\n    showPrevious: showPrevious,\n    showNext: showNext,\n    timeRemaining: timeRemaining,\n    secondsRemaining: secondsRemaining,\n    showSubmitButton: showSubmitButton,\n    isSubmitting: isSubmitting,\n    handleSubmit: handleSubmit\n  };\n}\n\n_s(useTestState, \"2thUIP9GDkQfCNLEbIgrsSY+EqA=\", false, function () {\n  return [useLocalState, useLocalState];\n});\n\nfunction getTimeRemainingInSeconds(start_time, duration) {\n  var totalDurationInSeconds = getSecondsFromDuration(duration);\n  var start = new Date(\"\".concat(start_time));\n  var now = new Date();\n  var end = new Date(\"\".concat(start_time));\n  end.setTime(start.getTime() + totalDurationInSeconds * 1000);\n  var secondsLeft = (end.getTime() - now.getTime()) / 1000;\n  return Math.floor(secondsLeft);\n}\n\nfunction getSecondsFromDuration(duration) {\n  var _duration$split = duration.split(\":\"),\n      _duration$split2 = _slicedToArray(_duration$split, 3),\n      hours = _duration$split2[0],\n      mins = _duration$split2[1],\n      seconds = _duration$split2[2];\n\n  var totalSeconds = 0;\n  totalSeconds += parseInt(hours) * 60 * 60;\n  totalSeconds += parseInt(mins) * 60;\n  totalSeconds += parseInt(seconds);\n  return totalSeconds;\n}\n\nfunction parseSecondsToClock(secondsRemaining) {\n  var mins = Math.floor(secondsRemaining / 60);\n  var seconds = Math.floor(secondsRemaining % 60);\n  return \"\".concat(mins < 10 ? \"0\".concat(mins) : mins, \":\").concat(seconds < 10 ? \"0\".concat(seconds) : seconds);\n}","map":{"version":3,"sources":["/home/ishraqkabir/workspace/smartifier-frontend/Components/QuizTest/Questions/useTestState.tsx"],"names":["useEffect","useState","useLocalState","submitTest","useTestState","quizId","questions","test","duration","user","email","id","answers","setAnswersState","currentQuestionIndex","setCurrentQuestionIndex","getProgress","progress","setProgress","getTimeRemainingInSeconds","created_at","toString","secondsRemaining","setSecondsRemaining","timeRemaining","setTimeRemaing","showSubmitButton","setShowSubmitButton","isSubmitting","setIsSubmitting","setInterval","handleSubmit","parseSecondsToClock","length","setAnswers","optionId","question","text","state","tempAnswers","answer_type","options","Array","isArray","includes","forEach","option","filter","goToNextQuestion","goToPreviousQuestion","showPrevious","showNext","alert","processedAnswers","Object","values","answer","push","token","response","error","window","location","href","start_time","totalDurationInSeconds","getSecondsFromDuration","start","Date","now","end","setTime","getTime","secondsLeft","Math","floor","split","hours","mins","seconds","totalSeconds","parseInt"],"mappings":"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","sourcesContent":["import { useEffect, useState } from \"react\";\nimport useLocalState from \"../../../custom-hooks/useLocalState\";\nimport IQuestion from \"../../../Models/IQuestion\";\nimport submitTest from \"../../../repository/QuizTest/submitTest\";\n\nexport default function useTestState(\n  quizId: number,\n  questions: IQuestion[],\n  test: any,\n  duration: string\n) {\n  const [user] = useLocalState(\"user\", \"\");\n  const [answers, setAnswersState] = useLocalState(\n    `${user?.email}-test${test?.id}-answers`,\n    {}\n  );\n\n  const [currentQuestionIndex, setCurrentQuestionIndex] = useState<number>(0);\n  const [progress, setProgress] = useState(getProgress());\n\n  const [secondsRemaining, setSecondsRemaining] = useState<number>(() => {\n    if (!test) return 600;\n\n    return getTimeRemainingInSeconds(test?.created_at, duration.toString());\n  });\n  const [timeRemaining, setTimeRemaing] = useState<string>(\"\");\n\n  const [showSubmitButton, setShowSubmitButton] = useState<boolean>(false);\n\n  const [isSubmitting, setIsSubmitting] = useState<boolean>(false);\n\n  useEffect(() => {\n    setInterval(() => {\n      setSecondsRemaining(\n        getTimeRemainingInSeconds(test?.created_at, duration)\n      );\n    }, 500);\n  }, []);\n\n  useEffect(() => {\n    if (secondsRemaining <= 0) {\n      handleSubmit();\n      setTimeRemaing(\"Test Finished\");\n    } else {\n      setTimeRemaing(parseSecondsToClock(secondsRemaining));\n    }\n  }, [secondsRemaining]);\n\n  useEffect(() => {\n    setProgress(getProgress());\n    if (currentQuestionIndex == questions?.length - 1) {\n      setShowSubmitButton(true);\n    } else {\n      setShowSubmitButton(false);\n    }\n  }, [currentQuestionIndex]);\n\n  const setAnswers = (optionId: number, question: IQuestion, text?: string) => {\n    setAnswersState((state: any) => {\n      let tempAnswers = { ...state };\n\n      if (question.answer_type === \"multiple_choice\") {\n        const options = tempAnswers[`${question?.id}`];\n\n        if (!options || (Array.isArray(options) && !options[0])) {\n          tempAnswers = {\n            ...state,\n            [`${question?.id}`]: [{ optionId: optionId }],\n          };\n        }\n\n        if (options && Array.isArray(options) && options[0]) {\n          if (options[0]?.optionId == optionId) {\n            tempAnswers = { ...state, [`${question?.id}`]: [] };\n          } else {\n            tempAnswers = {\n              ...state,\n              [`${question?.id}`]: [{ optionId: optionId }],\n            };\n          }\n        }\n      } else if (question?.answer_type === \"checkboxes\") {\n        const options = tempAnswers[`${question?.id}`];\n\n        if (!options || (Array.isArray(options) && !options[0])) {\n          tempAnswers = {\n            ...state,\n            [`${question?.id}`]: [{ optionId: optionId }],\n          };\n        }\n\n        if (options && Array.isArray(options)) {\n          let includes = false;\n\n          options?.forEach((option) => {\n            if (option?.optionId == optionId) {\n              includes = true;\n            }\n          });\n\n          if (includes) {\n            tempAnswers = {\n              ...state,\n              [`${question?.id}`]: options?.filter((option) => {\n                return option?.optionId != optionId;\n              }),\n            };\n          } else {\n            tempAnswers = {\n              ...state,\n              [`${question?.id}`]: [...options, { optionId: optionId }],\n            };\n          }\n        }\n      } else if (question?.answer_type === \"short_paragraph\") {\n        if (!text) return { ...tempAnswers };\n        tempAnswers = {\n          ...state,\n          [`${question?.id}`]: [\n            {\n              optionId: optionId,\n              text: text,\n            },\n          ],\n        };\n      }\n\n      return { ...tempAnswers };\n    });\n  };\n\n  const goToNextQuestion = () => {\n    if (currentQuestionIndex >= questions?.length - 1) return;\n    setCurrentQuestionIndex(currentQuestionIndex + 1);\n  };\n\n  const goToPreviousQuestion = () => {\n    if (currentQuestionIndex <= 0) return;\n    setCurrentQuestionIndex(currentQuestionIndex - 1);\n  };\n\n  const showPrevious: boolean = currentQuestionIndex != 0;\n  const showNext: boolean = currentQuestionIndex < questions?.length - 1;\n\n  function getProgress() {\n    if (questions?.length == 0) return 100;\n\n    return ((currentQuestionIndex + 1) * 100) / questions?.length;\n  }\n\n  async function handleSubmit() {\n    if (!answers) alert(\"Not enough answers to submit!\");\n    setIsSubmitting(true);\n\n    const processedAnswers = [];\n\n    Object.values(answers)?.forEach((answer: any) => {\n      if (answer && Array.isArray(answer)) {\n        answer?.forEach((option) => {\n          if (option?.optionId) {\n            processedAnswers.push({\n              optionId: option?.optionId,\n              text: option?.text ? option?.text : \"\",\n            });\n          }\n        });\n      }\n    });\n\n    const response = await submitTest(test?.id, processedAnswers, user?.token);\n\n    if (response.error || response == \"error\") {\n      alert(\"Something went wrong. Please refresh and submit the test.\");\n      return;\n    }\n\n    setAnswersState({});\n    window.location.href = `/test/${test?.id}/result`;\n    setIsSubmitting(false);\n  }\n\n  return {\n    answers,\n    setAnswers,\n    progress,\n    currentQuestionIndex,\n    goToNextQuestion,\n    goToPreviousQuestion,\n    showPrevious,\n    showNext,\n    timeRemaining,\n    secondsRemaining,\n    showSubmitButton,\n    isSubmitting,\n    handleSubmit,\n  };\n}\n\nfunction getTimeRemainingInSeconds(\n  start_time: string,\n  duration: string\n): number {\n  const totalDurationInSeconds: number = getSecondsFromDuration(duration);\n\n  const start = new Date(`${start_time}`);\n  const now = new Date();\n  const end = new Date(`${start_time}`);\n  end.setTime(start.getTime() + totalDurationInSeconds * 1000);\n\n  const secondsLeft: number = (end.getTime() - now.getTime()) / 1000;\n\n  return Math.floor(secondsLeft);\n}\n\nfunction getSecondsFromDuration(duration: string): number {\n  const [hours, mins, seconds] = duration.split(\":\");\n\n  let totalSeconds: number = 0;\n  totalSeconds += parseInt(hours) * 60 * 60;\n  totalSeconds += parseInt(mins) * 60;\n  totalSeconds += parseInt(seconds);\n\n  return totalSeconds;\n}\n\nfunction parseSecondsToClock(secondsRemaining: number): string {\n  const mins = Math.floor(secondsRemaining / 60);\n  const seconds = Math.floor(secondsRemaining % 60);\n\n  return `${mins < 10 ? `0${mins}` : mins}:${\n    seconds < 10 ? `0${seconds}` : seconds\n  }`;\n}\n"]},"metadata":{},"sourceType":"module"}