{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport React, { useEffect } from \"react\";\nimport axios from \"axios\";\nimport { local_backend_url } from \"../../url\";\nimport useLocalState from \"../../custom-hooks/useLocalState\";\nimport { Box, CircularProgress, LinearProgress, Typography, withStyles } from \"@material-ui/core\";\nimport { useRouter } from \"next/router\";\n\nvar Google = function Google() {\n  var router = useRouter();\n  var code = router.query.code;\n\n  var _useLocalState = useLocalState(\"user\", \"\"),\n      _useLocalState2 = _slicedToArray(_useLocalState, 2),\n      user = _useLocalState2[0],\n      setUser = _useLocalState2[1]; // useEffect(() => {\n  //   if (code) {\n  //     login();\n  //   }\n  // }, [code]);\n  // async function login() {\n  //   // get google id token (code)\n  //   const id_token = await getGoogleIdToken(code);\n  //   // get user data from google (id_token)\n  //   const {\n  //     email,\n  //     email_verified,\n  //     at_hash,\n  //     name,\n  //     picture,\n  //   } = await getUserDataFromGoogle(id_token);\n  //   // login to our own backend (\n  //   // id_token, email, at_hash, email_verified, name, picture\n  //   // )\n  //   const token = await backendSignIn({\n  //     id_token,\n  //     email,\n  //     at_hash,\n  //     email_verified,\n  //     name,\n  //     picture,\n  //   });\n  //   // set the user\n  //   const authUser: any = {\n  //     email: email,\n  //     name: name,\n  //     picture: picture,\n  //     token: token,\n  //   };\n  //   setUser(authUser);\n  // }\n\n\n  useEffect(function () {\n    if (code) {\n      axios({\n        method: \"get\",\n        url: \"/api/auth/google?get=user&code=\".concat(code)\n      }).then(function (res) {\n        var id_token = res.data.user.data.id_token;\n        axios({\n          method: \"GET\",\n          url: \"https://oauth2.googleapis.com/tokeninfo?id_token=\".concat(id_token)\n        }).then(function (response) {\n          var _response$data = response.data,\n              email = _response$data.email,\n              email_verified = _response$data.email_verified,\n              at_hash = _response$data.at_hash,\n              name = _response$data.name,\n              picture = _response$data.picture;\n          axios.post(\"\".concat(local_backend_url, \"/api/auth/googleSignIn\"), {\n            id_token: id_token,\n            email: email,\n            at_hash: at_hash,\n            email_verified: email_verified === \"true\" ? true : false,\n            name: name,\n            picture: picture\n          }).then(function (response) {\n            var token = response.data;\n            var user = {\n              email: email,\n              name: name,\n              picture: picture,\n              token: token\n            };\n            setUser(user);\n            window.close(); // router.replace(\"/\");\n          })[\"catch\"](function (error) {\n            // window.history.back();\n            console.log(error);\n          });\n        })[\"catch\"](function (error) {\n          console.log(error); // window.history.back();\n        });\n      });\n    }\n  }, [code]);\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsx(LinearProgress, {}), /*#__PURE__*/_jsxs(Container, {\n      children: [/*#__PURE__*/_jsx(Title, {\n        variant: \"h6\",\n        children: \"Please wait while we sign you in...\"\n      }), /*#__PURE__*/_jsx(Title, {\n        children: \"Redirecting you to smartifier.org...\"\n      }), /*#__PURE__*/_jsx(CircularProgress, {})]\n    })]\n  });\n};\n\nexport default Google;\nvar Container = withStyles({\n  root: {\n    width: \"100vw\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    alignItems: \"center\"\n  }\n})(Box);\nvar Title = withStyles({\n  root: {\n    textAlign: \"center\",\n    marginTop: 30,\n    marginBottom: 10\n  }\n})(Typography);","map":null,"metadata":{},"sourceType":"module"}