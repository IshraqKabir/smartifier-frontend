{"ast":null,"code":"import { google } from \"googleapis\";\n/*******/\n\n/* CONFIGURATION */\n\n/*******/\n\nconst googleConfig = {\n  clientId: process.env.GOOGLE_CLIENT_ID,\n  // e.g. asdfghjkljhgfdsghjk.apps.googleusercontent.com\n  clientSecret: process.env.GOOGLE_CLIENT_SECRET,\n  // e.g. _ASDFA%DFASDFASDFASD#FAD-\n  redirect: process.env.GOOGLE_REDIRECT_URL // this must match your google api settings\n\n};\nconst defaultScope = [\"https://www.googleapis.com/auth/plus.me\", \"https://www.googleapis.com/auth/userinfo.email\", \"https://www.googleapis.com/auth/userinfo.name\"];\n/*****/\n\n/* HELPERS */\n\n/*****/\n\nfunction createConnection() {\n  return new google.auth.OAuth2(googleConfig.clientId, googleConfig.clientSecret, googleConfig.redirect);\n}\n\nfunction getConnectionUrl(auth) {\n  return auth.generateAuthUrl({\n    access_type: \"offline\",\n    prompt: \"consent\",\n    scope: defaultScope\n  });\n}\n\nfunction getGooglePlusApi(auth) {\n  return google.plus({\n    version: \"v1\",\n    auth\n  });\n}\n/****/\n\n/* MAIN */\n\n/****/\n\n/**\n * Part 1: Create a Google URL and send to the client to log in the user.\n */\n\n\nfunction urlGoogle() {\n  const auth = createConnection();\n  const url = getConnectionUrl(auth);\n  return url;\n}\n/**\n * Part 2: Take the \"code\" parameter which Google gives us once when the user logs in, then get the user's email and id.\n */\n\n\nasync function getGoogleAccountFromCode(code) {\n  const auth = createConnection();\n  const data = await auth.getToken(code);\n  return {\n    data\n  };\n}\n\nexport default (async (req, res) => {\n  const {\n    get\n  } = req.query;\n\n  if (get === \"link\") {\n    res.statusCode = 200;\n    const url = urlGoogle();\n    res.json({\n      url\n    });\n  } else if (get === \"user\") {\n    if (!req.query.code) {\n      res.statusCode = 500;\n    } else {\n      const {\n        code\n      } = req.query;\n      const user = await getGoogleAccountFromCode(code);\n      res.statusCode = 200;\n      res.json({\n        user\n      });\n    }\n  } else {\n    res.statusCode = 500;\n  }\n});","map":{"version":3,"sources":["/home/ishraqkabir/workspace/smartifier-frontend/pages/api/auth/google.ts"],"names":["google","googleConfig","clientId","process","env","GOOGLE_CLIENT_ID","clientSecret","GOOGLE_CLIENT_SECRET","redirect","GOOGLE_REDIRECT_URL","defaultScope","createConnection","auth","OAuth2","getConnectionUrl","generateAuthUrl","access_type","prompt","scope","getGooglePlusApi","plus","version","urlGoogle","url","getGoogleAccountFromCode","code","data","getToken","req","res","get","query","statusCode","json","user"],"mappings":"AAAA,SAASA,MAAT,QAAuB,YAAvB;AAEA;;AACA;;AACA;;AAEA,MAAMC,YAAY,GAAG;AACnBC,EAAAA,QAAQ,EAAEC,OAAO,CAACC,GAAR,CAAYC,gBADH;AACqB;AACxCC,EAAAA,YAAY,EAAEH,OAAO,CAACC,GAAR,CAAYG,oBAFP;AAE6B;AAChDC,EAAAA,QAAQ,EAAEL,OAAO,CAACC,GAAR,CAAYK,mBAHH,CAGwB;;AAHxB,CAArB;AAMA,MAAMC,YAAY,GAAG,CACnB,yCADmB,EAEnB,gDAFmB,EAGnB,+CAHmB,CAArB;AAMA;;AACA;;AACA;;AAEA,SAASC,gBAAT,GAA4B;AAC1B,SAAO,IAAIX,MAAM,CAACY,IAAP,CAAYC,MAAhB,CACLZ,YAAY,CAACC,QADR,EAELD,YAAY,CAACK,YAFR,EAGLL,YAAY,CAACO,QAHR,CAAP;AAKD;;AAED,SAASM,gBAAT,CAA0BF,IAA1B,EAAgC;AAC9B,SAAOA,IAAI,CAACG,eAAL,CAAqB;AAC1BC,IAAAA,WAAW,EAAE,SADa;AAE1BC,IAAAA,MAAM,EAAE,SAFkB;AAG1BC,IAAAA,KAAK,EAAER;AAHmB,GAArB,CAAP;AAKD;;AAED,SAASS,gBAAT,CAA0BP,IAA1B,EAAgC;AAC9B,SAAOZ,MAAM,CAACoB,IAAP,CAAY;AAAEC,IAAAA,OAAO,EAAE,IAAX;AAAiBT,IAAAA;AAAjB,GAAZ,CAAP;AACD;AAED;;AACA;;AACA;;AAEA;AACA;AACA;;;AACA,SAASU,SAAT,GAAqB;AACnB,QAAMV,IAAI,GAAGD,gBAAgB,EAA7B;AACA,QAAMY,GAAG,GAAGT,gBAAgB,CAACF,IAAD,CAA5B;AACA,SAAOW,GAAP;AACD;AAED;AACA;AACA;;;AACA,eAAeC,wBAAf,CAAwCC,IAAxC,EAA8C;AAC5C,QAAMb,IAAI,GAAGD,gBAAgB,EAA7B;AACA,QAAMe,IAAI,GAAG,MAAMd,IAAI,CAACe,QAAL,CAAcF,IAAd,CAAnB;AACA,SAAO;AAAEC,IAAAA;AAAF,GAAP;AACD;;AAED,gBAAe,OAAOE,GAAP,EAAYC,GAAZ,KAAoB;AACjC,QAAM;AAAEC,IAAAA;AAAF,MAAUF,GAAG,CAACG,KAApB;;AAEA,MAAID,GAAG,KAAK,MAAZ,EAAoB;AAClBD,IAAAA,GAAG,CAACG,UAAJ,GAAiB,GAAjB;AACA,UAAMT,GAAG,GAAGD,SAAS,EAArB;AACAO,IAAAA,GAAG,CAACI,IAAJ,CAAS;AAAEV,MAAAA;AAAF,KAAT;AACD,GAJD,MAIO,IAAIO,GAAG,KAAK,MAAZ,EAAoB;AACzB,QAAI,CAACF,GAAG,CAACG,KAAJ,CAAUN,IAAf,EAAqB;AACnBI,MAAAA,GAAG,CAACG,UAAJ,GAAiB,GAAjB;AACD,KAFD,MAEO;AACL,YAAM;AAAEP,QAAAA;AAAF,UAAWG,GAAG,CAACG,KAArB;AAEA,YAAMG,IAAI,GAAG,MAAMV,wBAAwB,CAACC,IAAD,CAA3C;AAEAI,MAAAA,GAAG,CAACG,UAAJ,GAAiB,GAAjB;AACAH,MAAAA,GAAG,CAACI,IAAJ,CAAS;AAAEC,QAAAA;AAAF,OAAT;AACD;AACF,GAXM,MAWA;AACLL,IAAAA,GAAG,CAACG,UAAJ,GAAiB,GAAjB;AACD;AACF,CArBD","sourcesContent":["import { google } from \"googleapis\";\n\n/*******/\n/* CONFIGURATION */\n/*******/\n\nconst googleConfig = {\n  clientId: process.env.GOOGLE_CLIENT_ID, // e.g. asdfghjkljhgfdsghjk.apps.googleusercontent.com\n  clientSecret: process.env.GOOGLE_CLIENT_SECRET, // e.g. _ASDFA%DFASDFASDFASD#FAD-\n  redirect: process.env.GOOGLE_REDIRECT_URL, // this must match your google api settings\n};\n\nconst defaultScope = [\n  \"https://www.googleapis.com/auth/plus.me\",\n  \"https://www.googleapis.com/auth/userinfo.email\",\n  \"https://www.googleapis.com/auth/userinfo.name\",\n];\n\n/*****/\n/* HELPERS */\n/*****/\n\nfunction createConnection() {\n  return new google.auth.OAuth2(\n    googleConfig.clientId,\n    googleConfig.clientSecret,\n    googleConfig.redirect\n  );\n}\n\nfunction getConnectionUrl(auth) {\n  return auth.generateAuthUrl({\n    access_type: \"offline\",\n    prompt: \"consent\",\n    scope: defaultScope,\n  });\n}\n\nfunction getGooglePlusApi(auth) {\n  return google.plus({ version: \"v1\", auth });\n}\n\n/****/\n/* MAIN */\n/****/\n\n/**\n * Part 1: Create a Google URL and send to the client to log in the user.\n */\nfunction urlGoogle() {\n  const auth = createConnection();\n  const url = getConnectionUrl(auth);\n  return url;\n}\n\n/**\n * Part 2: Take the \"code\" parameter which Google gives us once when the user logs in, then get the user's email and id.\n */\nasync function getGoogleAccountFromCode(code) {\n  const auth = createConnection();\n  const data = await auth.getToken(code);\n  return { data };\n}\n\nexport default async (req, res) => {\n  const { get } = req.query;\n\n  if (get === \"link\") {\n    res.statusCode = 200;\n    const url = urlGoogle();\n    res.json({ url });\n  } else if (get === \"user\") {\n    if (!req.query.code) {\n      res.statusCode = 500;\n    } else {\n      const { code } = req.query;\n\n      const user = await getGoogleAccountFromCode(code);\n\n      res.statusCode = 200;\n      res.json({ user });\n    }\n  } else {\n    res.statusCode = 500;\n  }\n};\n"]},"metadata":{},"sourceType":"module"}